<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>An√°lise Financeira</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Configs globais (DEFINE window.CONFIG.WEBAPP) -->
  <script src="config.js"></script>

  <!-- Guard de autentica√ß√£o -->
  <script>
    (async ()=>{
      function goLogin(){
        const next = (location.pathname.split('/').pop() || 'index.html');
        location.replace('login.html?next=' + encodeURIComponent(next)); // <- n√£o deixa voltar
      }
      const WEBAPP = (window.CONFIG && window.CONFIG.WEBAPP);
      if(!WEBAPP){ console.error('CONFIG.WEBAPP n√£o definido'); goLogin(); return; }

      const token = localStorage.getItem('auth_token');
      if(!token){ goLogin(); return; }

      try{
        // usa text/plain pra evitar preflight e reduzir ‚Äúfalha de rede‚Äù
        const r = await fetch(`${WEBAPP}?fn=me`, {
          method: 'POST',
          headers: { 'Content-Type':'text/plain;charset=UTF-8' },
          body: JSON.stringify({ token })
        });
        const raw = await r.text();
        let j; try{ j = JSON.parse(raw); }catch{ goLogin(); return; }
        if(!j.ok){ localStorage.clear(); goLogin(); return; }

        window.AUTH_USER = j.user; // {usuario,empresa,perfil}
      }catch{
        goLogin();
      }
    })();

    // **Bloqueia o bot√£o voltar neste painel**
    (function lockBack(){
      // empurra um estado no hist√≥rico e reempurra quando o usu√°rio tenta voltar
      const push = ()=> history.pushState(null, '', location.href);
      push();
      window.addEventListener('popstate', (e)=> { push(); });
    })();
  </script>

  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#fff; }
    #splash{
      position:fixed; inset:0; background:#fff; display:flex; align-items:center; justify-content:center;
      z-index:9999; transition:opacity .5s ease;
    }
    #splash img{ width:150px; animation:pulse 1.5s infinite }
    @keyframes pulse{ 0%{transform:scale(1);opacity:1} 50%{transform:scale(1.05);opacity:.9} 100%{transform:scale(1);opacity:1} }

    header{
      background:#fff; color:#2c3e50; padding:20px 16px; display:flex; align-items:center; border-bottom:1px solid #ccc;
      gap:12px; flex-wrap:wrap;
    }
    .logo-left{ display:flex; align-items:center }
    .logo-left img{ height:56px; width:auto }
    .title-center{ flex:1 1 auto }
    .title-center h1{ margin:0; font-size:22px; font-weight:700 }
    .spacer{ margin-left:auto; display:flex; align-items:center; gap:12px }
    .relatorio-link{ text-decoration:none; font-size:22px; opacity:.6; transition:opacity .3s }
    .relatorio-link:hover{ opacity:1 }
    .user-profile img{
      width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid #ccc;transition:transform .2s ease
    }
    .user-profile img:hover{ transform:scale(1.08); border-color:#2980b9 }

    .container{
      display:grid; grid-template-columns:repeat(2,1fr); gap:16px; padding:20px; max-width:1200px; margin:auto;
    }
    .card{
      background:#fff; border-radius:12px; padding:22px 16px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,.08);
      transition:transform .2s ease, background-color .2s ease; text-decoration:none; color:inherit; min-height:110px;
    }
    .card:hover{ transform:translateY(-4px); background:#f5fbff }
    .card h2{ margin:6px 0 0; font-size:18px; color:#2c3e50; line-height:1.2; word-break:break-word }
    .card .icon{ font-size:34px; color:#2980b9; }

    @media (max-width:700px){
      .container{ grid-template-columns:1fr }
      header{ padding:16px }
      .title-center h1{ font-size:20px }
      .card{ padding:18px 14px }
      .card .icon{ font-size:30px }
      .card h2{ font-size:16px }
    }
  </style>
</head>
<body>

  <!-- Splash -->
  <div id="splash">
    <img src="https://github.com/ClenaStore/painel-principal/blob/main/img/GRUPO%20DV%20(1).png?raw=true" alt="Logo CB Systems">
  </div>

  <!-- Cabe√ßalho -->
  <header>
    <div class="logo-left">
      <img src="https://github.com/ClenaStore/painel-principal/blob/main/img/GRUPO%20DV%20(1).png?raw=true" alt="Logo">
    </div>
    <div class="title-center">
      <h1>An√°lise Financeira</h1>
    </div>
    <div class="spacer">
      <a href="index.relatorios.html" class="relatorio-link" title="Relat√≥rio Consolidado">üìÑ</a>
      <a href="perfil.html" title="Perfil do Usu√°rio" class="user-profile">
        <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Usu√°rio" />
      </a>
    </div>
  </header>

  <!-- Cards -->
  <div class="container">
    <a class="card" href="index.resumofinanceiro.html"><div class="icon">üìà</div><h2>Resumo Financeiro</h2></a>
    <a class="card" href="index.cancelamentos.html"><div class="icon">‚ùå</div><h2>Cancelamentos</h2></a>
    <a class="card" href="index.delivery.html"><div class="icon">üöö</div><h2>Vendas Delivery</h2></a>
    <a class="card" href="index.meta.html"><div class="icon">üìä</div><h2>Meta de Faturamento</h2></a>
    <a class="card" href="index.travas.html"><div class="icon">üîí</div><h2>Travas</h2></a>
    <a class="card" href="index.conciliacao.html"><div class="icon">üí≥</div><h2>Concilia√ß√µes</h2></a>
    <a class="card" href="https://grupodvbr.github.io/SISTEMA-CAP-GRUPO-DV/aprovacao.html"><div class="icon">‚úÖ</div><h2>Aprova√ß√£o de CAP</h2></a>
    <a class="card" href="index.abc.html"><div class="icon">ABC</div><h2>ABC de Vendas</h2></a>
    <a class="card" href="index.avaliacoes.html"><div class="icon">üîé</div><h2>Pesquisa de satisfa√ß√£o</h2></a>
  </div>

  <!-- Splash fade -->
  <script>
    window.addEventListener('load', ()=>{
      const splash = document.getElementById('splash');
      setTimeout(()=>{ splash.style.opacity='0'; setTimeout(()=> splash.style.display='none', 450); }, 900);
    });
  </script>

</body>
</html>
