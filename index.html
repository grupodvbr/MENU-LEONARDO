<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>An√°lise Financeira</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Carrega as configs globais (WEBAPP, etc.) -->
  <script src="config.js"></script>

  <!-- Guard de autentica√ß√£o (usa CONFIG.WEBAPP) -->
  <script>
    (async ()=>{
      function goLogin(){
        location.href = 'login.html?next='+encodeURIComponent(location.pathname.split('/').pop());
      }
      const WEBAPP = (window.CONFIG && window.CONFIG.WEBAPP);
      if(!WEBAPP){
        console.error('CONFIG.WEBAPP n√£o definido. Crie config.js com window.CONFIG.WEBAPP.');
        goLogin();
        return;
      }
      const token = localStorage.getItem('auth_token');
      if(!token){ goLogin(); return; }
      try{
        const url = `${WEBAPP}?fn=me&origin=${encodeURIComponent(location.origin)}`;
        const r = await fetch(url,{
          method:'POST',
          headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
          body: JSON.stringify({})
        });
        const j = await r.json();
        if(!j.ok){ localStorage.clear(); goLogin(); return; }
        window.AUTH_USER = j.user; // {usuario,empresa,perfil,iat,[exp]}
      }catch{
        goLogin();
      }
    })();
  </script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: white;
    }
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    #splash img { width: 150px; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%{transform:scale(1);opacity:1} 50%{transform:scale(1.05);opacity:.9} 100%{transform:scale(1);opacity:1} }

    header {
      background-color: white;
      color: #2c3e50;
      padding: 20px 40px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #ccc;
    }
    .logo-left { flex: 1; display: flex; align-items: center; }
    .logo-left img { height: 60px; }

    .user-profile { display: inline-block; margin-left: 15px; }
    .user-profile img {
      width: 36px; height: 36px; border-radius: 50%; object-fit: cover;
      border: 2px solid #ccc; transition: transform .2s ease;
    }
    .user-profile img:hover { transform: scale(1.1); border-color: #2980b9; }

    .title-left { flex: 2; text-align: left; }
    .title-left h1 { font-size: 24px; margin: 0; font-weight: bold; }

    .spacer { flex: 1; display: flex; justify-content: flex-end; }
    .relatorio-link {
      text-decoration: none; font-size: 22px; opacity: .5; cursor: pointer; transition: opacity .3s;
    }
    .relatorio-link:hover { opacity: 1; }

    .container {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
      padding: 30px; max-width: 1200px; margin: auto;
    }
    .card {
      background: white; border-radius: 12px; padding: 30px 20px; text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform .2s ease;
      text-decoration: none; color: inherit;
    }
    .card:hover { transform: translateY(-5px); background-color: #f0f8ff; }
    .card h2 { margin: 0; font-size: 20px; color: #2c3e50; }
    .icon { font-size: 40px; color: #2980b9; margin-bottom: 10px; }

    @media (max-width: 500px) {
      header { flex-direction: column; text-align: center; position: relative; }
      .logo-left { display: none; }
      .title-center { flex: none; width: 100%; }
      .spacer { position: absolute; top: 10px; right: 20px; display: flex; align-items: center; gap: 10px; }
      .card h2 { font-size: 18px; }
      .icon { font-size: 32px; }
      .card h2 { font-size: 18px; }
      .icon { font-size: 32px; }
    }
  </style>
</head>
<body>

  <!-- Splash -->
  <div id="splash">
    <img src="https://github.com/ClenaStore/painel-principal/blob/main/img/GRUPO%20DV%20(1).png?raw=true" alt="Logo CB Systems">
  </div>

  <!-- Cabe√ßalho -->
  <header>
    <div class="logo-left">
      <img src="https://github.com/ClenaStore/painel-principal/blob/main/img/GRUPO%20DV%20(1).png?raw=true" alt="Logo">
    </div>
    <div class="title-center">
      <h1>An√°lise Financeira</h1>
    </div>
    <div class="spacer">
      <a href="index.relatorios.html" class="relatorio-link" title="Relat√≥rio Consolidado">üìÑ</a>
      <a href="perfil.html" title="Perfil do Usu√°rio" class="user-profile">
        <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Usu√°rio" />
      </a>
    </div>
  </header>

  <!-- Cards -->
  <div class="container">
    <a class="card" href="index.resumofinanceiro.html">
      <div class="icon">üìà</div>
      <h2>Resumo Financeiro</h2>
    </a>

    <a class="card" href="index.cancelamentos.html">
      <div class="icon">‚ùå</div>
      <h2>Cancelamentos</h2>
    </a>

    <a class="card" href="index.delivery.html">
      <div class="icon">üöö</div>
      <h2>Vendas Delivery</h2>
    </a>

    <a class="card" href="index.meta.html">
      <div class="icon">üìä</div>
      <h2>Meta de Faturamento</h2>
    </a>

    <a class="card" href="index.travas.html">
      <div class="icon">üîí</div>
      <h2>Travas</h2>
    </a>

    <a class="card" href="index.conciliacao.html">
      <div class="icon">üí≥</div>
      <h2>Concilia√ß√µes</h2>
    </a>

    <!-- Se quiser, pode mover esta URL externa para CONFIG.PAGES.CAP_APROVACAO e usar via JS -->
    <a class="card" href="https://grupodvbr.github.io/SISTEMA-CAP-GRUPO-DV/aprovacao.html">
      <div class="icon">‚úÖ</div>
      <h2>Aprova√ß√£o de CAP</h2>
    </a>

    <a class="card" href="index.abc.html">
      <div class="icon">ABC</div>
      <h2>ABC de Vendas</h2>
    </a>

    <a class="card" href="index.avaliacoes.html">
      <div class="icon">üîé</div>
      <h2>Pesquisa de satisfa√ß√£o</h2>
    </a>
  </div>

  <!-- Script splash -->
  <script>
    window.addEventListener('load', () => {
      const splash = document.getElementById('splash');
      setTimeout(() => {
        splash.style.opacity = '0';
        setTimeout(() => splash.style.display = 'none', 500);
      }, 1000);
    });
  </script>

</body>
</html>
