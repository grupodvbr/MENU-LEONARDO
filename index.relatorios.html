<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Relatório Consolidado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
  const WEBAPP = 'https://script.google.com/macros/s/AKfycbzbwI7zmPH5owQ1PGHmKeolFL2za-24GiqiT4Ue3Ec-fAIzDyZjTFqX1THAsD8Wx14iRA/exec';
  (async ()=>{
    function goLogin(){ location.href = 'login.html?next='+encodeURIComponent(location.pathname.split('/').pop()); }
    const token = localStorage.getItem('auth_token'); if(!token){ goLogin(); return; }
    try{
      const url = `${WEBAPP}?fn=me&origin=${encodeURIComponent(location.origin)}`;
      const r = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({})});
      const j = await r.json();
      if(!j.ok){ localStorage.clear(); goLogin(); return; }
      window.AUTH_USER = j.user; // {usuario,empresa,perfil,iat,exp}
    }catch{ goLogin(); }
  })();
</script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: white;
      padding-top: 40px; /* espaço para cabeçalho fixo */
    }
    /* Cabeçalho fixo */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 15px;
      z-index: 1100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.7);
    }
    header a {
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    header a:hover svg path {
      fill: #25d366;
    }
    header svg {
      width: 24px;
      height: 24px;
      fill: white;
      transition: fill 0.3s ease;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding: 20px;
    }
    .card {
      position: relative;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      background: white;
      color: black;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
    }
    .btn-open {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #388e3c;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 0.85em;
      cursor: pointer;
      z-index: 10;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .btn-open:hover {
      background-color: #2c6f2c;
    }
    /* Modal */
    #modalOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.75);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    #modalContent {
      position: relative;
      width: 90%;
      max-width: 900px;
      height: 80vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      overflow: hidden;
    }
    #modalContent iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    #modalClose {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #e74c3c;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      color: white;
      font-weight: bold;
      font-size: 18px;
      line-height: 28px;
      cursor: pointer;
      z-index: 10;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #modalClose:hover {
      background-color: #c0392b;
    }

    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr;
      }
      iframe {
        height: 500px;
      }
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html" title="Voltar para tela principal" aria-label="Voltar para tela principal">
      <!-- Ícone de casa simples SVG -->
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
    </a>
  </header>

  <div class="grid">
    <div class="card" data-url="https://grupodvbr.github.io/MENU-LEONARDO/index.resumofinanceiro.html">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src="https://grupodvbr.github.io/MENU-LEONARDO/index.resumofinanceiro.html"></iframe>
    </div>
    <div class="card" data-url="https://grupodvbr.github.io/MENU-LEONARDO/index.delivery.html">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src="https://grupodvbr.github.io/MENU-LEONARDO/index.delivery.html"></iframe>
    </div>
    <div class="card" data-url="https://grupodvbr.github.io/MENU-LEONARDO/index.cancelamentos.html">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src="https://grupodvbr.github.io/MENU-LEONARDO/index.cancelamentos.html"></iframe>
    </div>
    <div class="card" data-url="https://grupodvbr.github.io/MENU-LEONARDO/index.conciliacao.html">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src="https://grupodvbr.github.io/MENU-LEONARDO/index.conciliacao.html"></iframe>
    </div>
    <div class="card" data-url="https://grupodvbr.github.io/MENU-LEONARDO/index.meta.html">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src="https://grupodvbr.github.io/MENU-LEONARDO/index.meta.html"></iframe>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modalContent">
      <button id="modalClose" title="Fechar">&times;</button>
      <iframe src="" frameborder="0"></iframe>
    </div>
  </div>

  <script>
    const modalOverlay = document.getElementById('modalOverlay');
    const modalIframe = modalOverlay.querySelector('iframe');
    const modalClose = document.getElementById('modalClose');

    // Abrir modal com url
    function abrirModal(url) {
      modalIframe.src = url;
      modalOverlay.style.display = 'flex';
    }

    // Fechar modal
    function fecharModal() {
      modalIframe.src = '';
      modalOverlay.style.display = 'none';
    }

    modalClose.addEventListener('click', fecharModal);
    modalOverlay.addEventListener('click', e => {
      if(e.target === modalOverlay) fecharModal();
    });

    // Botões abrir nos cards
    document.querySelectorAll('.btn-open').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation(); // para não disparar o triple click do card
        const card = btn.closest('.card');
        const url = card.getAttribute('data-url');
        abrirModal(url);
      });
    });

    // Triple click para abrir em nova aba (mantido)
    document.querySelectorAll('.card').forEach(card => {
      let clickCount = 0;
      let clickTimer = null;

      card.addEventListener('click', () => {
        clickCount++;

        if (clickCount === 3) {
          const url = card.getAttribute('data-url');
          window.open(url, '_blank');
          resetClicks();
          return;
        }

        if (clickTimer) clearTimeout(clickTimer);
        clickTimer = setTimeout(() => {
          resetClicks();
        }, 600);

        function resetClicks() {
          clickCount = 0;
          clickTimer = null;
        }
      });
    });
  </script>
</body>
</html>
