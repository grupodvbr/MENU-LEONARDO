<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Relatório Consolidado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- config + guarda de sessão -->
  <script src="config.js"></script>
  <script>
    (async ()=>{ try{ await AUTH.ensure(); }catch(e){} })();
  </script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: white;
      padding-top: 40px; /* espaço para cabeçalho fixo */
    }
    /* Cabeçalho fixo */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 15px;
      z-index: 1100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.7);
    }
    header a {
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    header a:hover svg path {
      fill: #25d366;
    }
    header svg {
      width: 24px;
      height: 24px;
      fill: white;
      transition: fill 0.3s ease;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding: 20px;
    }
    .card {
      position: relative;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      background: white;
      color: black;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
    }
    .btn-open {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #388e3c;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 0.85em;
      cursor: pointer;
      z-index: 10;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .btn-open:hover {
      background-color: #2c6f2c;
    }
    /* Modal */
    #modalOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.75);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    #modalContent {
      position: relative;
      width: 90%;
      max-width: 900px;
      height: 80vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      overflow: hidden;
    }
    #modalContent iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    #modalClose {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #e74c3c;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      color: white;
      font-weight: bold;
      font-size: 18px;
      line-height: 28px;
      cursor: pointer;
      z-index: 10;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #modalClose:hover {
      background-color: #c0392b;
    }

    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr;
      }
      iframe {
        height: 500px;
      }
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html" title="Voltar para tela principal" aria-label="Voltar para tela principal">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
    </a>
  </header>

  <div class="grid">
    <!-- agora usamos data-key; as URLs vêm do APP_PAGES no config.js -->
    <div class="card" data-key="resumoFinanceiro">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src=""></iframe>
    </div>
    <div class="card" data-key="delivery">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src=""></iframe>
    </div>
    <div class="card" data-key="cancelamentos">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src=""></iframe>
    </div>
    <div class="card" data-key="conciliacao">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src=""></iframe>
    </div>
    <div class="card" data-key="meta">
      <button class="btn-open" title="Abrir relatório">Abrir</button>
      <iframe src=""></iframe>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modalContent">
      <button id="modalClose" title="Fechar">&times;</button>
      <iframe src="" frameborder="0"></iframe>
    </div>
  </div>

  <script>
    // Fallback local caso APP_PAGES não esteja no config.js (dev)
    const PAGES = (typeof APP_PAGES !== 'undefined') ? APP_PAGES : {
      resumoFinanceiro: 'https://grupodvbr.github.io/MENU-LEONARDO/index.resumofinanceiro.html',
      delivery:         'https://grupodvbr.github.io/MENU-LEONARDO/index.delivery.html',
      cancelamentos:    'https://grupodvbr.github.io/MENU-LEONARDO/index.cancelamentos.html',
      conciliacao:      'https://grupodvbr.github.io/MENU-LEONARDO/index.conciliacao.html',
      meta:             'https://grupodvbr.github.io/MENU-LEONARDO/index.meta.html'
    };

    // injeta URLs nos cards/iframes
    document.querySelectorAll('.card').forEach(card=>{
      const key = card.dataset.key;
      const url = PAGES[key] || '';
      card.dataset.url = url;
      const iframe = card.querySelector('iframe');
      if (iframe && url) iframe.src = url;
    });

    const modalOverlay = document.getElementById('modalOverlay');
    const modalIframe = modalOverlay.querySelector('iframe');
    const modalClose = document.getElementById('modalClose');

    function abrirModal(url) {
      modalIframe.src = url;
      modalOverlay.style.display = 'flex';
    }
    function fecharModal() {
      modalIframe.src = '';
      modalOverlay.style.display = 'none';
    }
    modalClose.addEventListener('click', fecharModal);
    modalOverlay.addEventListener('click', e => {
      if(e.target === modalOverlay) fecharModal();
    });

    // Botões abrir nos cards
    document.querySelectorAll('.btn-open').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation();
        const card = btn.closest('.card');
        const url = card.getAttribute('data-url');
        abrirModal(url);
      });
    });

    // Triple click para abrir em nova aba (mantido)
    document.querySelectorAll('.card').forEach(card => {
      let clickCount = 0;
      let clickTimer = null;

      card.addEventListener('click', () => {
        clickCount++;

        if (clickCount === 3) {
          const url = card.getAttribute('data-url');
          window.open(url, '_blank');
          resetClicks();
          return;
        }

        if (clickTimer) clearTimeout(clickTimer);
        clickTimer = setTimeout(() => { resetClicks(); }, 600);

        function resetClicks() {
          clickCount = 0;
          clickTimer = null;
        }
      });
    });
  </script>
</body>
</html>
